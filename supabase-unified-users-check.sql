-- ============================================
-- Проверка и обновление для единой регистрации
-- ============================================
-- После убирания разделения на специалистов/компании
-- один пользователь может быть и в specialists, и в companies

-- Проверяем текущие политики RLS
-- Они уже должны позволять пользователю создавать записи в обеих таблицах

-- 1. Проверяем политики для specialists
SELECT 
  'specialists' as table_name,
  policyname,
  cmd as command,
  qual as using_expression
FROM pg_policies 
WHERE schemaname = 'public' 
AND tablename = 'specialists'
ORDER BY policyname;

-- 2. Проверяем политики для companies
SELECT 
  'companies' as table_name,
  policyname,
  cmd as command,
  qual as using_expression
FROM pg_policies 
WHERE schemaname = 'public' 
AND tablename = 'companies'
ORDER BY policyname;

-- ============================================
-- ВАЖНО: Ничего менять не нужно!
-- ============================================
-- Текущие политики уже позволяют:
-- - Пользователю создавать запись в specialists (WHERE auth.uid() = id)
-- - Пользователю создавать запись в companies (WHERE auth.uid() = id)
-- 
-- Это означает, что один и тот же пользователь может быть
-- одновременно и специалистом, и компанией, что нам и нужно.
--
-- Функция ensureProfileRecord в коде проверяет существование
-- записи перед созданием, так что дубликаты не создадутся.

-- ============================================
-- Опционально: можно добавить комментарий к таблицам
-- ============================================
COMMENT ON TABLE specialists IS 'Профили пользователей. Один пользователь может быть одновременно и специалистом, и компанией (в таблице companies).';
COMMENT ON TABLE companies IS 'Профили для создания задач. Один пользователь может быть одновременно и специалистом (в таблице specialists), и компанией.';

