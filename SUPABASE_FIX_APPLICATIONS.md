# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª–∏—Ç–∏–∫ –¥–æ—Å—Ç—É–ø–∞ –∫ –æ—Ç–∫–ª–∏–∫–∞–º –≤ Supabase

## –ü—Ä–æ–±–ª–µ–º–∞
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –æ—Ç–∫–ª–∏–∫–∏ –Ω–∞ —á—É–∂–∏–µ –∑–∞–¥–∞—á–∏, —á—Ç–æ –Ω–∞—Ä—É—à–∞–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

## –†–µ—à–µ–Ω–∏–µ
–ù—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å RLS (Row Level Security) –ø–æ–ª–∏—Ç–∏–∫–∏ –≤ Supabase, —á—Ç–æ–±—ã:
- **–í–ª–∞–¥–µ–ª—å—Ü—ã –ø—Ä–æ–µ–∫—Ç–æ–≤** –º–æ–≥–ª–∏ –≤–∏–¥–µ—Ç—å –æ—Ç–∫–ª–∏–∫–∏ **–¢–û–õ–¨–ö–û –Ω–∞ —Å–≤–æ–∏ –∑–∞–¥–∞—á–∏**
- **–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã** –º–æ–≥–ª–∏ –≤–∏–¥–µ—Ç—å **–¢–û–õ–¨–ö–û —Å–≤–æ–∏ –æ—Ç–∫–ª–∏–∫–∏**
- **–ù–µ-–≤–ª–∞–¥–µ–ª—å—Ü—ã** –Ω–µ –º–æ–≥–ª–∏ –≤–∏–¥–µ—Ç—å –æ—Ç–∫–ª–∏–∫–∏ –Ω–∞ —á—É–∂–∏–µ –∑–∞–¥–∞—á–∏

---

## üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—é

### –®–∞–≥ 1: –û—Ç–∫—Ä–æ–π—Ç–µ SQL Editor –≤ Supabase
1. –í–æ–π–¥–∏—Ç–µ –≤ [Supabase Dashboard](https://supabase.com)
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç
3. –û—Ç–∫—Ä–æ–π—Ç–µ **SQL Editor** (–∏–∫–æ–Ω–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤ –±–æ–∫–æ–≤–æ–º –º–µ–Ω—é)
4. –ù–∞–∂–º–∏—Ç–µ **"New query"**

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü—ã projects
–í—ã–ø–æ–ª–Ω–∏—Ç–µ —ç—Ç–æ—Ç –∑–∞–ø—Ä–æ—Å, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ–ª–µ `user_id`:

```sql
SELECT column_name, data_type 
FROM information_schema.columns 
WHERE table_name = 'projects' 
  AND column_name IN ('user_id', 'company_id')
ORDER BY column_name;
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–ª–µ `user_id` —Ç–∏–ø–∞ `uuid`

### –®–∞–≥ 3: –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –≤–µ—Å—å —Å–∫—Ä–∏–ø—Ç –∏–∑ —Ñ–∞–π–ª–∞ `fix-applications-policies.sql`

–ò–ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—ã –Ω–∏–∂–µ:

```sql
-- –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏
DROP POLICY IF EXISTS "Applications are viewable by project owner and applicant" ON applications;
DROP POLICY IF EXISTS "Project owners can update applications" ON applications;
DROP POLICY IF EXISTS "–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã –º–æ–≥—É—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Å–≤–æ–∏ –∑–∞—è–≤–∫–∏" ON applications;
DROP POLICY IF EXISTS "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∑–∞—è–≤–∫–∏ –Ω–∞ —Å–≤–æ–∏ –∑–∞–¥–∞—á–∏" ON applications;
DROP POLICY IF EXISTS "–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∑–∞—è–≤–∫–∏" ON applications;
DROP POLICY IF EXISTS "–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã –º–æ–≥—É—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å —Å–≤–æ–∏ –∑–∞—è–≤–∫–∏" ON applications;
DROP POLICY IF EXISTS "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞—è–≤–æ–∫ –Ω–∞ —Å–≤–æ–∏ –∑–∞–¥–∞—á–∏" ON applications;
DROP POLICY IF EXISTS "Specialists can insert their own applications" ON applications;
DROP POLICY IF EXISTS "Specialists can update their own applications" ON applications;

-- –°–æ–∑–¥–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏
CREATE POLICY "–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã –º–æ–≥—É—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Å–≤–æ–∏ –∑–∞—è–≤–∫–∏"
  ON applications FOR SELECT
  USING (auth.uid() = specialist_id);

CREATE POLICY "–í–ª–∞–¥–µ–ª—å—Ü—ã –ø—Ä–æ–µ–∫—Ç–æ–≤ –º–æ–≥—É—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∑–∞—è–≤–∫–∏ –Ω–∞ —Å–≤–æ–∏ –∑–∞–¥–∞—á–∏"
  ON applications FOR SELECT
  USING (
    EXISTS (
      SELECT 1 FROM projects
      WHERE projects.id = applications.project_id
      AND projects.user_id = auth.uid()
    )
  );

CREATE POLICY "–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∑–∞—è–≤–∫–∏"
  ON applications FOR INSERT
  WITH CHECK (auth.uid() = specialist_id);

CREATE POLICY "–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã –º–æ–≥—É—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å —Å–≤–æ–∏ –∑–∞—è–≤–∫–∏"
  ON applications FOR UPDATE
  USING (auth.uid() = specialist_id);

CREATE POLICY "–í–ª–∞–¥–µ–ª—å—Ü—ã –ø—Ä–æ–µ–∫—Ç–æ–≤ –º–æ–≥—É—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞—è–≤–æ–∫ –Ω–∞ —Å–≤–æ–∏ –∑–∞–¥–∞—á–∏"
  ON applications FOR UPDATE
  USING (
    EXISTS (
      SELECT 1 FROM projects
      WHERE projects.id = applications.project_id
      AND projects.user_id = auth.uid()
    )
  );
```

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
–í—ã–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–ª–∏—Ç–∏–∫:

```sql
SELECT 
  policyname,
  cmd,
  qual,
  with_check
FROM pg_policies
WHERE tablename = 'applications'
ORDER BY policyname;
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –î–æ–ª–∂–Ω–æ –±—ã—Ç—å 5 –ø–æ–ª–∏—Ç–∏–∫:
1. `–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã –º–æ–≥—É—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Å–≤–æ–∏ –∑–∞—è–≤–∫–∏` (SELECT)
2. `–í–ª–∞–¥–µ–ª—å—Ü—ã –ø—Ä–æ–µ–∫—Ç–æ–≤ –º–æ–≥—É—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∑–∞—è–≤–∫–∏ –Ω–∞ —Å–≤–æ–∏ –∑–∞–¥–∞—á–∏` (SELECT)
3. `–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∑–∞—è–≤–∫–∏` (INSERT)
4. `–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã –º–æ–≥—É—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å —Å–≤–æ–∏ –∑–∞—è–≤–∫–∏` (UPDATE)
5. `–í–ª–∞–¥–µ–ª—å—Ü—ã –ø—Ä–æ–µ–∫—Ç–æ–≤ –º–æ–≥—É—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞—è–≤–æ–∫ –Ω–∞ —Å–≤–æ–∏ –∑–∞–¥–∞—á–∏` (UPDATE)

---

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –∫–æ–¥–µ

1. **–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–ª–∞–¥–µ–ª—å—Ü–∞** –≤ —Ñ—É–Ω–∫—Ü–∏—é `getApplications()` - —Ç–µ–ø–µ—Ä—å –æ–Ω–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–ª–∞–¥–µ–ª—å—Ü–µ–º –ø—Ä–æ–µ–∫—Ç–∞ –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π –æ—Ç–∫–ª–∏–∫–æ–≤
2. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω localStorage fallback** - —Ç–µ–ø–µ—Ä—å –æ—Ç–∫–ª–∏–∫–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–∞ –∑–∞–¥–∞—á–∏
3. **–£–ª—É—á—à–µ–Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

---

## üß™ –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–°–æ–∑–¥–∞–π—Ç–µ –∑–∞–¥–∞—á—É** –æ—Ç –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. **–í–æ–π–¥–∏—Ç–µ –ø–æ–¥ –¥—Ä—É–≥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º** –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ:
   - –û—Ç–∫—Ä—ã—Ç—å –∑–∞–¥–∞—á—É –ø–µ—Ä–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ—Ç–∫–ª–∏–∫–∏ –ù–ï –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ç–æ–ª—å–∫–æ –∫–Ω–æ–ø–∫–∞ "–ü–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É")
   - –û—Ç–ø—Ä–∞–≤—å—Ç–µ –æ—Ç–∫–ª–∏–∫
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–∫–ª–∏–∫–∏ –≤—Å—ë —Ä–∞–≤–Ω–æ –Ω–µ –≤–∏–¥–Ω—ã
3. **–í–æ–π–¥–∏—Ç–µ –ø–æ–¥ –≤–ª–∞–¥–µ–ª—å—Ü–µ–º –∑–∞–¥–∞—á–∏** –∏ —É–±–µ–¥–∏—Ç–µ—Å—å:
   - –û—Ç–∫–ª–∏–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è
   - –ú–æ–∂–Ω–æ –≤–∏–¥–µ—Ç—å –≤—Å–µ –æ—Ç–∫–ª–∏–∫–∏ –Ω–∞ —Å–≤–æ—é –∑–∞–¥–∞—á—É

---

## ‚ö†Ô∏è –í–∞–∂–Ω–æ

- –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–∞ –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª–∏—Ç–∏–∫–∏ –±—É–¥—É—Ç –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω—ã
- RLS –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∫–ª—é—á–µ–Ω –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã `applications` (–ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
- –ï—Å–ª–∏ –≤ –≤–∞—à–µ–π –±–∞–∑–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `company_id` –≤–º–µ—Å—Ç–æ `user_id`, –Ω—É–∂–Ω–æ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–∏—Ç–∏–∫–∏

